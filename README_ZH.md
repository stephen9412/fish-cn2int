# fish-cn2int

Fish Shell 的确定性中文数字转整数工具。

## 特性

- **确定性解析**：基于明确的中文数字进行无歧义转换
- **完整范围**：支持 0 到 999,999,999（9亿9999万9999）
- **多种变体**：
  - 繁体中文：一二三、壹贰参
  - 简体中文：一二三、贰叁陆
  - 混合格式：萬/万、億/亿
  - 零的变体：零、〇
- **广泛的测试覆盖**：1004+ 个测试用例，采用 TDD 方法
- **纯 Fish Shell**：无外部依赖

## 安装

### 使用 Fisher

```fish
fisher install stephen9412/fish-cn2int
```

### 手动安装

克隆此仓库并加载函数：

```fish
git clone https://github.com/stephen9412/fish-cn2int.git
source fish-cn2int/functions/cn2int.fish
```

或将 `functions/cn2int.fish` 复制到 `~/.config/fish/functions/` 目录。

## 使用

```fish
cn2int 一二三四五         # 12345
cn2int 九千九百九十九     # 9999
cn2int 一万二千三百四十五 # 12345
cn2int 壹亿贰仟叁佰肆拾伍万陆仟柒佰捌拾玖 # 123456789
```

### 支持的格式

#### 标准中文数字

```fish
cn2int 一         # 1
cn2int 十         # 10
cn2int 一百       # 100
cn2int 一千       # 1000
cn2int 一万       # 10000
cn2int 一亿       # 100000000
```

#### 大写（金融）

```fish
cn2int 壹         # 1
cn2int 拾         # 10
cn2int 壹佰       # 100
cn2int 壹仟       # 1000
cn2int 壹万       # 10000
cn2int 壹亿       # 100000000
```

#### 简体变体

```fish
cn2int 一万       # 10000（万 代替 萬）
cn2int 一亿       # 100000000（亿 代替 億）
cn2int 贰仟       # 2000（贰 代替 貳）
```

#### 隐式格式

```fish
cn2int 二三       # 23（隐式十位）
cn2int 一二三     # 123（隐式百位）
cn2int 一二三四   # 1234（隐式千位）
```

#### 零的处理

```fish
cn2int 一千零一   # 1001
cn2int 一万零一   # 10001
cn2int 一亿零一万 # 100010000
```

## 重要：确定性解析

此解析器使用**确定性规则**，不解释口语化的简写：

### ⚠️ 不支持口语表达

```fish
# 这些遵循严格的位置规则：
cn2int 二百五     # 205（不是 250）
cn2int 一百一     # 101（不是 110）
cn2int 三千五     # 3005（不是 3500）
```

如果你想要这些口语含义，请明确写出：

```fish
cn2int 二百五十   # 250 ✓
cn2int 一百一十   # 110 ✓
cn2int 三千五百   # 3500 ✓
```

### 为什么要确定性？

口语化的中文数字**依赖上下文**且有歧义：
- "二百五" 可能表示 250 或 205
- "一百一" 可能表示 110 或 101
- "三千五" 可能表示 3500 或 3005

此解析器遵循**明确、无歧义的规则**，以便在脚本和自动化中可靠使用。

## 支持的数字范围

- **最小值**：0（零/〇）
- **最大值**：999,999,999（九亿九千九百九十九万九千九百九十九）

## 测试

此项目使用 [fishtape](https://github.com/jorgebucaran/fishtape) 进行测试。

### 安装 fishtape

```fish
fisher install jorgebucaran/fishtape
```

### 运行测试

```fish
fishtape tests/*.fish
```

### 测试覆盖

- 1004+ 个测试用例
- 按功能组织的测试：
  - 阿拉伯数字直通
  - 单位数（小写/大写）
  - 十、百、千
  - 万（萬/万）
  - 亿（億/亿）
  - 边界案例和隐式格式
  - 零的处理（零/〇）
  - 繁简体混用

## 架构

```
cn2int（入口）
  └─> _cn_map_digits（字符映射）
  └─> _parse_number（主解析器）
       ├─> 处理 億（亿）
       ├─> 处理 萬（万）
       └─> _parse_simple（0-9999 解析器）
            ├─> 处理 千
            ├─> 处理 百
            ├─> 处理 十
            └─> 处理隐式数字
```

## 示例

### 复杂数字

```fish
cn2int 九亿八千七百六十五万四千三百二十一
# 987654321

cn2int 壹亿贰仟叁佰肆拾伍万陆仟柒佰捌拾玖
# 123456789

cn2int 三亿零五万零七
# 300050007
```

### 混合格式

```fish
cn2int 壹万贰仟叁佰     # 大写混合简体 万
# 12300

cn2int 五億零叁萬        # 繁体 億 混合简体 叁
# 500030000
```

## 贡献

欢迎贡献！请确保：

1. 所有测试通过：`fishtape tests/*.fish`
2. 新功能包含测试用例
3. 遵循现有代码风格
4. 更新文档

## 许可证

MIT 许可证 - 详见 LICENSE 文件。

## 作者

**Stephen J. Li**

- Github: [@stephen9412](https://github.com/stephen9412)

### 🏕️ 创作环境

完成在台湾花莲玉里的[安通温泉](https://maps.app.goo.gl/rGRqAtDvDUSemJd66)旁的露营车上。欢迎约我一起来泡温泉！

---

**注意**：这是一个确定性解析器，针对可靠性和无歧义解析进行了优化，不适用于随意/口语化的中文数字解释。
